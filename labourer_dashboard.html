{% extends "dashboard/base.html" %}

{% block title %}Labourer Dashboard{% endblock %}
{% block user_role %}Labourer{% endblock %}
{% block user_name %}{{ labourer.full_name }}{% endblock %}
{% block user_email %}{{ labourer.email if labourer.email else labourer.phone }}{% endblock %}
{% block user_id %}{{ labourer.id }}{% endblock %}
{% block user_short_name %}{{ labourer.full_name.split(' ')[0] }}{% endblock %}
{% block page_title %}Labourer Dashboard{% endblock %}

{% block sidebar_menu %}
<li><a href="#" class="active"><i class="fas fa-home"></i> Dashboard</a></li>
<li><a href="#"><i class="fas fa-user"></i> My Profile</a></li>
<li><a href="#"><i class="fas fa-briefcase"></i> Active Jobs</a></li>
<li><a href="#"><i class="fas fa-search"></i> Find Jobs</a></li>
<li><a href="#"><i class="fas fa-calendar-alt"></i> Schedule</a></li>
<li><a href="#"><i class="fas fa-comments"></i> Messages <span class="badge">3</span></a></li>
<li><a href="#"><i class="fas fa-wallet"></i> Earnings</a></li>
<li><a href="#"><i class="fas fa-star"></i> Ratings</a></li>
<li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-briefcase"></i>
        </div>
        <div class="stat-info">
            <h3>Active Jobs</h3>
            <p class="stat-number">{{ stats.active_jobs }}</p>
            <p class="stat-change">4 days work this week</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-info">
            <h3>Completed Jobs</h3>
            <p class="stat-number">{{ stats.completed_jobs }}</p>
            <p class="stat-change">This year</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-rupee-sign"></i>
        </div>
        <div class="stat-info">
            <h3>Total Earnings</h3>
            <p class="stat-number">₹{{ stats.total_earnings|int }}</p>
            <p class="stat-change">This year</p>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-star"></i>
        </div>
        <div class="stat-info">
            <h3>Rating</h3>
            <p class="stat-number">{{ stats.rating }}</p>
            <p class="stat-change">28 reviews</p>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
    <div class="actions-grid">
        <button class="action-btn">
            <i class="fas fa-search"></i>
            <span>Find Jobs</span>
        </button>
        <button class="action-btn">
            <i class="fas fa-calendar-plus"></i>
            <span>Update Availability</span>
        </button>
        <button class="action-btn">
            <i class="fas fa-user-plus"></i>
            <span>Add Skills</span>
        </button>
        <button class="action-btn">
            <i class="fas fa-comments"></i>
            <span>View Messages</span>
        </button>
        <button class="action-btn">
            <i class="fas fa-wallet"></i>
            <span>Withdraw Earnings</span>
        </button>
        <button class="action-btn">
            <i class="fas fa-star"></i>
            <span>View Ratings</span>
        </button>
    </div>
</div>

<div class="dashboard-grid">
    <!-- Active Jobs -->
    <div class="dashboard-card">
        <div class="card-header">
            <h3><i class="fas fa-briefcase"></i> Active Jobs</h3>
            <a href="#" class="view-all">View All</a>
        </div>
        <div class="card-body">
            <div class="job-list">
                <div class="job-item">
                    <div class="job-info">
                        <h4>Masonry Work</h4>
                        <p class="job-meta">Contractor: BuildRight Constructions</p>
                        <p class="job-meta">Location: Andheri, Mumbai</p>
                        <p class="job-meta">Rate: ₹{{ labourer.daily_wage }}/day | Duration: 15 days</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 60%"></div>
                        </div>
                        <p class="progress-text">Day 9 of 15</p>
                    </div>
                    <div class="job-actions">
                        <button class="btn-sm"><i class="fas fa-eye"></i> Details</button>
                        <button class="btn-sm"><i class="fas fa-comment"></i> Chat</button>
                    </div>
                </div>

                <div class="job-item">
                    <div class="job-info">
                        <h4>Painting Work</h4>
                        <p class="job-meta">Customer: Mr. Sharma</p>
                        <p class="job-meta">Location: Bandra, Mumbai</p>
                        <p class="job-meta">Rate: ₹{{ (labourer.daily_wage * 0.9)|int }}/day | Duration: 10 days</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 20%"></div>
                        </div>
                        <p class="progress-text">Day 2 of 10</p>
                    </div>
                    <div class="job-actions">
                        <button class="btn-sm"><i class="fas fa-eye"></i> Details</button>
                        <button class="btn-sm"><i class="fas fa-comment"></i> Chat</button>
                    </div>
                </div>
            </div>
            <button class="btn full-width"><i class="fas fa-search"></i> Find More Jobs</button>
        </div>
    </div>

    <!-- Available Jobs -->
    <div class="dashboard-card">
        <div class="card-header">
            <h3><i class="fas fa-bell"></i> Recommended Jobs</h3>
            <a href="#" class="view-all">View All</a>
        </div>
        <div class="card-body">
            <div class="job-list">
                <div class="job-item">
                    <div class="job-info">
                        <h4>Carpentry Work</h4>
                        <p class="job-meta">Contractor: WoodWorks Ltd.</p>
                        <p class="job-meta">Location: 5km from you</p>
                        <p class="job-meta">Rate: ₹{{ (labourer.daily_wage * 1.1)|int }}/day | Duration: 20 days</p>
                        <p class="job-meta">Starts: Tomorrow</p>
                    </div>
                    <button class="btn-sm apply-btn">Apply</button>
                </div>

                <div class="job-item">
                    <div class="job-info">
                        <h4>Electrical Work</h4>
                        <p class="job-meta">Customer: Ms. Patel</p>
                        <p class="job-meta">Location: 3km from you</p>
                        <p class="job-meta">Rate: ₹{{ (labourer.daily_wage * 1.5)|int }}/day | Duration: 5 days</p>
                        <p class="job-meta">Starts: Today</p>
                    </div>
                    <button class="btn-sm apply-btn">Apply</button>
                </div>

                <div class="job-item">
                    <div class="job-info">
                        <h4>Plumbing Work</h4>
                        <p class="job-meta">Contractor: WaterFlow Solutions</p>
                        <p class="job-meta">Location: 8km from you</p>
                        <p class="job-meta">Rate: ₹{{ (labourer.daily_wage * 1.3)|int }}/day | Duration: 7 days</p>
                        <p class="job-meta">Starts: Monday</p>
                    </div>
                    <button class="btn-sm apply-btn">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Earnings Overview -->
    <div class="dashboard-card">
        <div class="card-header">
            <h3><i class="fas fa-wallet"></i> Earnings Overview</h3>
            <a href="#" class="view-all">View Details</a>
        </div>
        <div class="card-body">
            <div class="earnings-stats">
                <div class="earning-item">
                    <span class="earning-label">This Week</span>
                    <span class="earning-amount">₹{{ (stats.total_earnings/20)|int }}</span>
                </div>
                <div class="earning-item">
                    <span class="earning-label">This Month</span>
                    <span class="earning-amount">₹{{ (stats.total_earnings/6)|int }}</span>
                </div>
                <div class="earning-item">
                    <span class="earning-label">Total Balance</span>
                    <span class="earning-amount">₹{{ (stats.total_earnings/10)|int }}</span>
                </div>
                <div class="earning-item">
                    <span class="earning-label">Pending</span>
                    <span class="earning-amount">₹{{ (stats.total_earnings/40)|int }}</span>
                </div>
            </div>
            
            <div class="withdrawal-options">
                <h4>Withdraw Earnings</h4>
                <div class="withdrawal-methods">
                    <button class="method-btn">
                        <i class="fas fa-university"></i>
                        <span>Bank Transfer</span>
                    </button>
                    <button class="method-btn">
                        <i class="fas fa-mobile-alt"></i>
                        <span>UPI</span>
                    </button>
                    <button class="method-btn">
                        <i class="fas fa-wallet"></i>
                        <span>Wallet</span>
                    </button>
                </div>
                <button class="btn full-width"><i class="fas fa-rupee-sign"></i> Withdraw Now</button>
            </div>
        </div>
    </div>

    <!-- Profile & Skills -->
    <div class="dashboard-card">
        <div class="card-header">
            <h3><i class="fas fa-user-cog"></i> Profile & Skills</h3>
            <a href="#" class="view-all">Edit Profile</a>
        </div>
        <div class="card-body">
            <div class="profile-summary">
                <div class="skill-tags">
                    {% for skill in labourer.skills %}
                    <span class="skill-tag">{{ skill }}</span>
                    {% endfor %}
                </div>
                
                <div class="profile-stats">
                    <div class="profile-stat">
                        <span class="stat-label">Experience</span>
                        <span class="stat-value">{{ labourer.experience_years }} years</span>
                    </div>
                    <div class="profile-stat">
                        <span class="stat-label">Daily Rate</span>
                        <span class="stat-value">₹{{ labourer.daily_wage }} - ₹{{ (labourer.daily_wage * 1.5)|int }}</span>
                    </div>
                    <div class="profile-stat">
                        <span class="stat-label">Availability</span>
                        <span class="stat-value {% if labourer.availability %}available{% else %}unavailable{% endif %}">
                            {% if labourer.availability %}Available{% else %}Unavailable{% endif %}
                        </span>
                    </div>
                </div>
                
                <div class="rating-display">
                    <div class="stars">
                        {% for i in range(5) %}
                            {% if i < stats.rating|int %}
                                <i class="fas fa-star"></i>
                            {% elif i < stats.rating %}
                                <i class="fas fa-star-half-alt"></i>
                            {% else %}
                                <i class="far fa-star"></i>
                            {% endif %}
                        {% endfor %}
                    </div>
                    <span class="rating-text">{{ stats.rating }}/5 (28 reviews)</span>
                </div>
            </div>
            
            <button class="btn full-width"><i class="fas fa-edit"></i> Update Profile</button>
        </div>
    </div>
</div>

<!-- Work Schedule -->
<div class="dashboard-card full-width">
    <div class="card-header">
        <h3><i class="fas fa-calendar-alt"></i> Work Schedule - This Week</h3>
        <a href="#" class="view-all">Full Calendar</a>
    </div>
    <div class="card-body">
        <div class="schedule-week">
            <div class="day-schedule">
                <div class="day-header">Mon</div>
                <div class="day-jobs">
                    <div class="job-slot active">
                        <span class="job-time">9AM-6PM</span>
                        <span class="job-title">Masonry Work</span>
                    </div>
                </div>
            </div>
            <div class="day-schedule">
                <div class="day-header">Tue</div>
                <div class="day-jobs">
                    <div class="job-slot active">
                        <span class="job-time">9AM-6PM</span>
                        <span class="job-title">Masonry Work</span>
                    </div>
                </div>
            </div>
            <div class="day-schedule">
                <div class="day-header">Wed</div>
                <div class="day-jobs">
                    <div class="job-slot active">
                        <span class="job-time">9AM-6PM</span>
                        <span class="job-title">Masonry Work</span>
                    </div>
                </div>
            </div>
            <div class="day-schedule">
                <div class="day-header">Thu</div>
                <div class="day-jobs">
                    <div class="job-slot active">
                        <span class="job-time">9AM-6PM</span>
                        <span class="job-title">Masonry Work</span>
                    </div>
                </div>
            </div>
            <div class="day-schedule">
                <div class="day-header">Fri</div>
                <div class="day-jobs">
                    <div class="job-slot active">
                        <span class="job-time">9AM-6PM</span>
                        <span class="job-title">Painting Work</span>
                    </div>
                </div>
            </div>
            <div class="day-schedule">
                <div class="day-header">Sat</div>
                <div class="day-jobs">
                    <div class="job-slot active">
                        <span class="job-time">9AM-1PM</span>
                        <span class="job-title">Painting Work</span>
                    </div>
                </div>
            </div>
            <div class="day-schedule">
                <div class="day-header">Sun</div>
                <div class="day-jobs">
                    <div class="job-slot holiday">
                        <span class="job-title">Weekly Off</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity -->
<div class="dashboard-card full-width">
    <div class="card-header">
        <h3><i class="fas fa-history"></i> Recent Activity</h3>
    </div>
    <div class="card-body">
        <div class="activity-timeline">
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="activity-content">
                    <p>Payment of ₹{{ (stats.total_earnings/40)|int }} received for last week's work</p>
                    <span class="activity-time">Today, 9:00 AM</span>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-briefcase"></i>
                </div>
                <div class="activity-content">
                    <p>Started new painting job at Mr. Sharma's house</p>
                    <span class="activity-time">Yesterday, 8:30 AM</span>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-star"></i>
                </div>
                <div class="activity-content">
                    <p>Received 5-star rating from BuildRight Constructions</p>
                    <span class="activity-time">2 days ago</span>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-comment"></i>
                </div>
                <div class="activity-content">
                    <p>New message from contractor about schedule change</p>
                    <span class="activity-time">3 days ago</span>
                </div>
            </div>
            <div class="activity-item">
                <div class="activity-icon">
                    <i class="fas fa-search"></i>
                </div>
                <div class="activity-content">
                    <p>Applied for carpentry job at WoodWorks Ltd.</p>
                    <span class="activity-time">4 days ago</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}